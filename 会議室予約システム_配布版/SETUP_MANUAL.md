# 📖 会議室予約システム - 詳細セットアップマニュアル

本マニュアルでは、会議室予約システムの完全なセットアップ手順を説明します。

## 📋 目次

1. [システム要件](#システム要件)
2. [インストール手順](#インストール手順)
3. [設定ファイルの詳細](#設定ファイルの詳細)
4. [カスタマイズ方法](#カスタマイズ方法)
5. [トラブルシューティング](#トラブルシューティング)
6. [運用・保守](#運用保守)

## 🖥️ システム要件

### 必須要件
- **OS**: Windows 10 (version 1903以降) / Windows 11
- **Python**: 3.7以上（3.9以上を強く推奨）
- **メモリ**: 最低2GB（推奨: 4GB以上）
- **ディスク容量**: 500MB以上の空き容量
- **ネットワーク**: インターネット接続（初期セットアップ時）

### 推奨環境
- **CPU**: Intel Core i3以上またはAMD Ryzen 3以上
- **メモリ**: 8GB以上
- **ディスク**: SSD推奨（応答速度向上）

## 🔧 インストール手順

### Step 1: Pythonのインストール

#### 🔍 Pythonインストール状況の確認

まず、既にPythonがインストールされているか確認します：

1. **コマンドプロンプトを開く**
   - Windowsキー + R → `cmd` → Enter

2. **Pythonの確認**
   ```cmd
   python --version
   pip --version
   ```

3. **結果の判定**
   - バージョン情報が表示される → 既にインストール済み（Step 2へ）
   - 「'python' は、内部コマンドまたは外部コマンド...」 → インストールが必要

#### 🐍 Python 3.9の詳細インストール手順

**Pythonが未インストールの場合のみ実行してください。**

##### 1. ダウンロード
1. **Python公式サイト**にアクセス: https://www.python.org/downloads/
2. **「Download Python 3.9.x」**をクリック
   - 最新の3.9系列を推奨（例：Python 3.9.18）
   - Windows x86-64 executable installer を選択

##### 2. インストール実行
1. **インストーラーを管理者権限で実行**
   - `python-3.9.x-amd64.exe` を右クリック → 「管理者として実行」

2. **⚠️ 重要設定（必須）**
   - **「Add Python to PATH」に必ずチェック**を入れる
   - 「Use admin privileges when installing py.exe」にもチェック推奨
   - **「Install Now」をクリック**

3. **インストール完了まで待機**
   - 通常3-5分程度で完了

##### 3. インストール確認
1. **新しいコマンドプロンプトを開く**（古いものは閉じる）
   ```cmd
   python --version
   pip --version
   ```

2. **期待される出力**
   ```
   Python 3.9.18
   pip 23.x.x from C:\Users\[ユーザー名]\AppData\Local\Programs\Python\Python39\lib\site-packages\pip (python 3.9)
   ```

#### 🔧 PATH環境変数のトラブルシューティング

**`python --version`でエラーが出る場合**:

##### 方法1: 環境変数の手動設定
1. **システムプロパティを開く**
   - Windowsキー + R → `sysdm.cpl` → Enter

2. **環境変数の編集**
   - 「詳細設定」タブ → 「環境変数」ボタン

3. **システム環境変数のPath編集**
   - 「システム環境変数」欄で「Path」を選択 → 「編集」

4. **Pythonパスの追加**
   - 「新規」をクリックして以下を追加：
   ```
   C:\Users\[ユーザー名]\AppData\Local\Programs\Python\Python39\
   C:\Users\[ユーザー名]\AppData\Local\Programs\Python\Python39\Scripts\
   ```
   - **注意**: `[ユーザー名]`は実際のWindowsユーザー名に置き換え

5. **設定の適用**
   - 「OK」→「OK」→ コマンドプロンプトを完全に閉じて再起動

##### 方法2: Pythonランチャーの使用
PATHが設定できない場合は、`py`コマンドを使用：
```cmd
py --version
py -m pip --version
```

##### 方法3: Pythonの再インストール
上記で解決しない場合：
1. **アプリと機能**からPythonをアンインストール
2. 上記手順で再インストール（PATHチェックを確実に実行）

#### 🚨 よくある問題と解決策

**問題1**: 「Microsoft Store」が開いてしまう
```
原因: Windows 10/11のPython用のエイリアスが有効
解決方法:
1. 設定 → アプリ → アプリ実行エイリアス
2. 「Python」を無効にする
```

**問題2**: 複数のPythonがインストールされている
```
確認方法: where python
解決方法: 最新の3.9系のパスを環境変数の上位に配置
```

**問題3**: 管理者権限でのみ動作する
```
原因: インストール時の権限設定
解決方法: 一般ユーザーでもアクセス可能なディレクトリに再インストール
```

### Step 2: システムファイルの配置

1. **配布パッケージ**を任意のフォルダに解凍
   - 推奨: `C:\会議室予約システム_配布版\`
   - 避ける: スペースや日本語を含むパス（トラブル回避）

2. **フォルダ構成確認**:
   ```
   会議室予約システム_配布版/
   ├── server_fixed.py           # メインアプリケーション
   ├── config.json               # 設定ファイル
   ├── easy_setup_silent.vbs     # セットアップスクリプト
   ├── start_server.bat          # サーバー起動スクリプト
   ├── config_editor.pyw         # 設定エディター
   ├── trouble_shooter.bat       # トラブルシューティング
   ├── test_system_simple.py     # システムテスト
   ├── index.html               # Webインターフェース
   ├── data/                    # データ格納フォルダ
   ├── uploads/                 # アップロード用フォルダ
   ├── processed/               # 処理済みファイル用フォルダ
   └── config_templates/        # 設定テンプレート
   ```

### Step 3: 自動セットアップ（推奨）

**GUIセットアップ**:
```cmd
easy_setup_silent.vbs をダブルクリック
```

このスクリプトが以下を自動実行：
- Python環境チェック
- 必要ライブラリのインストール
- サンプルデータでのシステム起動
- ブラウザ自動オープン（http://localhost:5003）

### Step 4: 手動インストール（上級者向け）

**依存関係のインストール**:
```cmd
pip install -r requirements.txt
```

**直接起動**:
```cmd
python server_fixed.py
```

### Step 5: 初期設定

1. **システムトレイアイコンから設定エディター起動**:
   - システムトレイの青いカレンダーアイコンを右クリック
   - 「設定エディタ」を選択

2. **基本設定の確認・変更**:
   - 会議室表示設定（会議室名、表示名、色設定）
   - ポップアップ項目設定（詳細表示項目）
   - 分割表示ルール（会議室の分割利用設定）

## ⚙️ 設定ファイルの詳細

### config.json の構造

```json
{
  "rooms": [
    {
      "csv_name": "ホールⅠ",     // CSVファイル内の会議室名
      "id": "hall-1",           // システム内部ID
      "display_name": "ホールⅠ"  // 画面表示名
    }
  ],
  "csv_column_mapping": {
    "booking_datetime": "利用日時(予約内容)",
    "room_name": "会議室(予約内容)",
    "display_name": "案内表示名(予約内容)"
  },
  "data_split_rules": [
    {
      "source_room_id": "hall-combined",
      "target_room_ids": ["hall-1", "hall-2"],
      "enabled": true
    }
  ]
}
```

### 設定項目の詳細説明

#### 1. rooms配列
各会議室の設定を定義します。

- **csv_name**: CSVファイル内で使用される会議室名（完全一致）
- **id**: システム内部で使用する一意ID（英数字のみ推奨）
- **display_name**: ユーザーに表示される会議室名
- **color**: 会議室の表示色（16進数カラーコード）

#### 2. modal_fields
ポップアップ表示項目の設定を行います。

**設定方法**:
- 設定エディター → 「ポップアップ表示項目」タブ
- 表示したい項目にチェックを入れる
- 「設定を保存」ボタンで保存

#### 3. data_split_rules
会議室の分割表示ルールを設定します。

**用途**: 「ホール全」を「ホールⅠ」と「ホールⅡ」に分割表示
**設定方法**:
- 設定エディター → 「分割表示設定」タブ
- 分割元会議室と分割先会議室を設定

### CSV読み込み機能

#### 📊 会議室項目設定のためCSV読み込み
- 会議室情報を自動的にCSVファイルから読み込み
- 新しい会議室の自動追加
- 分割表示ルールの推奨設定

#### 📋 ポップアップ項目設定のためCSV読み込み
- ポップアップ表示項目のみを更新
- 既存の会議室設定を保持
- CSVヘッダーから表示項目を自動抽出

## 🎨 カスタマイズ方法

### 会議室設定の変更

#### 新しい会議室の追加
```json
{
  "csv_name": "新会議室A",
  "id": "new-room-a", 
  "display_name": "新会議室A"
}
```

#### 内部利用会議室の指定
```json
"internal_room_ids": ["executive-room", "staff-room"]
```

### CSVヘッダーの対応

#### カスタムヘッダーの追加
```json
"csv_column_mapping": {
  "custom_field": "カスタム項目(予約内容)",
  "special_note": "特記事項"
}
```

### UI言語の変更

#### モーダル表示項目のカスタマイズ
```json
"modal_fields": {
  "利用日時(予約内容)": "利用日時(予約内容)",
  "新しい項目": "新しい項目"
}
```

## 🚨 トラブルシューティング

### よくある問題と解決方法

#### 1. Pythonインストール関連

**問題**: `'python' は、内部コマンドまたは外部コマンド...`
```
解決方法:
1. Pythonが正しくインストールされているか確認
2. 環境変数PATHにPythonが追加されているか確認
3. コマンドプロンプトを再起動
```

**問題**: `pip install` でエラーが発生
```
解決方法:
1. 管理者権限でコマンドプロンプトを起動
2. pip を最新版にアップデート: python -m pip install --upgrade pip
3. ファイアウォール設定を確認
```

#### 2. アプリケーション起動関連

**問題**: `Port 5003 is already in use`
```
解決方法:
1. 既存のアプリケーションを終了
2. システムトレイのアイコンから「システム終了」
3. タスクマネージャーでpython.exeプロセスを終了
4. server_fixed.py内のポート番号を変更 (例: 5004)
```

**問題**: ブラウザが自動で開かない
```
解決方法:
1. 手動でブラウザを開く
2. http://localhost:5003 にアクセス
3. ファイアウォール設定を確認
4. システムトレイアイコン → 「ブラウザで開く」を選択
```

**問題**: システムトレイにアイコンが表示されない
```
解決方法:
1. Windows設定 → システム → 通知とアクション → 通知領域
2. 「タスクバーに表示するアイコンを選択してください」を確認
3. 必要に応じてPythonアプリケーションを有効化
4. システムを再起動して再度実行
```

#### 3. CSV処理関連

**問題**: CSVファイルが読み込めない
```
解決方法:
1. 文字エンコードを確認（UTF-8推奨）
2. CSVヘッダー名がconfig.jsonと一致しているか確認
3. ファイル形式がCSV（.csv）になっているか確認
```

**問題**: 日本語が文字化けする
```
解決方法:
1. CSVファイルをUTF-8-BOMで保存
2. Excel の場合: 「UTF-8 CSV」形式で保存
3. config.jsonの文字エンコードを確認
```

#### 4. 設定エディター関連

**問題**: 設定エディターが起動しない
```
解決方法:
1. tkinter がインストールされているか確認
2. Python標準ライブラリの再インストール
3. config_editor.pyw を Python.exe で直接起動
```

### ログファイルの確認

システムの詳細な動作状況は以下のログファイルで確認できます：

- **app_debug.log**: アプリケーションのデバッグログ
- **コンソール出力**: リアルタイムの処理状況

### パフォーマンス最適化

#### メモリ使用量の最適化
```python
# config.json に追加可能な設定
"performance_config": {
  "cache_duration": 5,     // キャッシュ保持時間（秒）
  "max_file_size": 16,     // 最大ファイルサイズ（MB）
  "upload_delay": 60       // アップロード処理遅延（秒）
}
```

## 🔄 運用・保守

### 定期メンテナンス

#### 1. ログファイルの管理
- 月1回: ログファイルのサイズ確認
- 必要に応じて古いログを削除

#### 2. システムアップデート
- Python のセキュリティアップデート確認
- 依存関係ライブラリの更新

#### 3. バックアップ
- config.json の定期バックアップ
- 処理済みCSVファイルのアーカイブ

### セキュリティ注意事項

#### 1. ネットワークアクセス
- デフォルトでは localhost（127.0.0.1）のみアクセス可能
- 他のPCからアクセスする場合はファイアウォール設定が必要

#### 2. ファイルアップロード
- 16MB の ファイルサイズ制限
- CSVファイル以外のアップロード制限
- セキュアなファイル名処理

### 障害対応

#### システム停止時の対応
1. **ログファイル確認**: app_debug.log でエラー詳細を確認
2. **プロセス確認**: タスクマネージャーでPythonプロセスを確認
3. **再起動**: start_server.bat で再起動
4. **設定確認**: config.json の設定内容を確認

#### データ復旧
1. **処理済みフォルダ**: 過去の処理済みCSVファイルを確認
2. **バックアップ**: 定期バックアップからの復旧
3. **ログ解析**: 処理履歴の確認

---

## 📞 サポート・問い合わせ

技術的な問題や不明な点がございましたら：

1. **GitHub Issues**: バグ報告・機能要望
2. **メール サポート**: 個別対応が必要な場合
3. **FAQ**: よくある質問と回答

---

**📝 このマニュアルは継続的に更新されます。最新版をご確認ください。**