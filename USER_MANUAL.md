# 👥 会議室予約システム - ユーザーマニュアル

このマニュアルでは、会議室予約システムの日常的な使用方法を説明します。

## 📋 目次

1. [基本操作](#基本操作)
2. [システムトレイ操作](#システムトレイ操作)
3. [KasikaiCSVdl2連携](#kasikaicsvdl2連携)
4. [CSVファイルのアップロード](#csvファイルのアップロード)
5. [予約情報の確認](#予約情報の確認)
6. [設定の変更](#設定の変更)
7. [よくある質問](#よくある質問)

## 🖥️ 基本操作

### システムの起動

**推奨方法: easy_setup_silent.vbs**
1. **`easy_setup_silent.vbs`** をダブルクリック
2. GUIダイアログに従ってセットアップ完了
3. 自動的にシステム起動・ブラウザオープン

**直接起動方法:**
1. **`python server_fixed.py`** をコマンドラインで実行
2. または **`easy_setup.bat`** をダブルクリック

### システムの終了

**システムトレイから終了（推奨）:**
1. **右下のシステムトレイアイコンを右クリック**
2. **「終了」を選択**

**コマンドラインから終了:**
1. **コマンドプロンプト画面で `Ctrl + C`** を押す

### アクセス方法

- **ローカルアクセス**: http://localhost:5000
- **ネットワークアクセス**: http://[PCのIPアドレス]:5000

## 🔧 システムトレイ操作

### システムトレイメニュー

PCの右下にある **会議室アイコン（青いカレンダー）** を右クリック：

#### 🌐 **ブラウザで開く**
- http://localhost:5000 を自動で開く
- 手動でブラウザを開く必要なし

#### ⚙️ **設定エディタ**
- 会議室設定画面を自動起動
- GUIで簡単に設定変更可能

#### 📊 **システム情報**
- ローカルアクセスURL: http://127.0.0.1:5000
- ネットワークアクセスURL: http://[IPアドレス]:5000
- アップロードフォルダパス
- データフォルダパス

#### 🔚 **終了**
- システム安全終了

### 画面の見方

#### メイン画面構成
```
┌─────────────────────┬─────────────────────────────────┐
│    サイドバー        │         カレンダー表示          │
│ ・日付選択          │  ┌──────┬──────┬──────┬──────┐ │
│ ・会議室フィルター   │  │ 午前 │ 午後 │ 夜間 │ 一日 │ │
│ ・CSVアップロード   │  ├──────┼──────┼──────┼──────┤ │
│ ・システム制御      │  │予約A │予約B │予約C │      │ │
│ ・システム制御      │  └──────┴──────┴──────┴──────┘ │
└─────────────────────┴─────────────────────────────────┘
```

#### 新機能UI要素
- **リアルタイム更新**: 10秒間隔でデータ自動更新
- **凡例表示**: 色分けルールの説明
- **システム制御パネル**: 設定エディタ、システム情報アクセス

#### 色分けの意味
- **薄青色**: 内部利用会議室（internal-room スタイル）
- **黄色**: 特別料金（無料・合計金額0円の予約）
- **青色**: 一般利用（有料）
- **ピンク色**: 本日の予約（today-highlight）
- **白色**: 予約なし

## 🔗 KasikaiCSVdl2連携

### 🔧 KasikaiCSVdl2とは？

**KasikaiCSVdl2** は、この会議室予約表示システムと連携する専用のCSVダウンロードツールです。

#### 主要機能
- **自動データ取得**: 会議室予約管理システムから最新の予約データを自動取得
- **自動ファイル配置**: ダウンロードしたCSVファイルを `uploads` フォルダに自動配置
- **シームレス連携**: この予約表示システムが自動的にデータを処理・統合

### 🔄 連携の流れ

#### 標準的な運用フロー
1. **KasikaiCSVdl2** → 予約管理システムからCSVデータをダウンロード
2. **uploadsフォルダ** → 自動的にファイルが配置される
3. **予約表示システム** → ファイル監視により自動データ処理開始
4. **データ統合** → `processed_bookings.csv` として統合データを作成
5. **Webカレンダー** → 最新データを表示（手動更新で反映）

#### 日々の運用
- **KasikaiCSVdl2** で定期的にデータをダウンロード
- **自動化設定** により手動操作を最小限に
- **手動更新** で最新の予約状況を表示（「🔄 ステータス更新」ボタン または ブラウザリロード）

### ⚙️ 自動化設定

#### KasikaiCSVdl2側の設定
- **自動アップロード機能**: 定期的な自動データダウンロード
- **スケジュール設定**: 毎日決まった時間に実行
- **ファイル配置設定**: `uploads` フォルダへの自動配置

#### 予約表示システム側の自動処理
- **ファイル監視**: `uploads` フォルダを常時監視
- **自動データ処理**: 新しいCSVファイルを検出すると即座に処理
- **データ統合**: 複数ファイルの自動統合・重複排除
- **手動更新**: 「🔄 ステータス更新」ボタンをクリックまたはブラウザリロードで表示更新

### 🔍 トラブルシューティング

#### よくある問題
**Q: KasikaiCSVdl2でダウンロードしたファイルが反映されない**
```
A: 1. uploadsフォルダにファイルが配置されているか確認
   2. ファイル名に日本語文字が含まれていないか確認
   3. CSVファイルのエンコーディングを確認（UTF-8推奨）
   4. システムトレイ → 「システム情報」でログを確認
```

**Q: データが古いまま更新されない**
```
A: 1. KasikaiCSVdl2の自動更新設定を確認
   2. 手動でKasikaiCSVdl2を実行してみる
   3. 予約表示システムの再起動
   4. uploadsフォルダの権限を確認
```

## 📤 CSVファイルのアップロード

### Webアップロード手順

1. **サイドバーの「CSVファイルをアップロード」セクション**を確認
2. **「ファイルを選択」**ボタンをクリック
3. **複数のCSVファイル**を選択可能（拡張子は .csv のみ）
4. **「アップロード」**ボタンをクリック
5. **進行状況表示**で処理状況を確認
6. **約2秒後**に自動的にデータが反映されます

### フォルダ監視機能（自動処理）

**推奨方法**: `uploads` フォルダに直接保存
1. **`uploads`** フォルダにCSVファイルを保存
2. **自動的に監視・処理開始**（約2秒後）
3. 処理完了後、ファイルは **`processed`** フォルダに移動
4. **タイムスタンプ付き**でファイル名が変更されて保存

### CSVファイルの形式

#### 必須ヘッダー
最低限必要なヘッダー項目：
```csv
利用日時(予約内容),会議室(予約内容),案内表示名(予約内容)
```

#### 推奨ヘッダー
```csv
利用日時(予約内容),会議室(予約内容),案内表示名(予約内容),事業所名,担当者名
```

#### 完全版ヘッダー例
```csv
利用日時(予約内容),会議室(予約内容),合計金額(予約内容),取消日(予約内容),案内表示名(予約内容),事業所名,延長(予約内容),備品(予約内容),備考（ご要望や持込機材などございましたらご入力ください。）,メモ,利用目的(予約内容),会員種別(予約内容),部署名,担当者名,郵便番号,都道府県,市区町村,以降の住所,電話番号,FAX番号
```

#### サンプルデータ
```csv
利用日時(予約内容),会議室(予約内容),案内表示名(予約内容),事業所名,担当者名,合計金額(予約内容)
2025年01月20日 午前,ホールⅠ,新年度企画会議,株式会社サンプル,田中太郎,50000
2025年01月20日 午後,ホールⅡ,研修会,テスト企業,佐藤花子,30000
2025年01月21日 一日,ホール全,年次総会,大手株式会社,山田次郎,150000
```

### 利用日時の書式

#### 対応している書式
- **日付**: `2025年01月20日` 形式
- **時間帯**:
  - `午前` → 午前の時間帯
  - `午後` → 午後の時間帯
  - `夜間` → 夜間の時間帯
  - `一日` → 終日利用（自動的に午前・午後・夜間に分割）
  - `午前・午後` → 午前と午後の複数時間帯
  - `午後・夜間` → 午後と夜間の複数時間帯
  - `午前・夜間` → 午前と夜間の複数時間帯
  - `午前・午後・夜間` → 全時間帯

#### 新機能: 一日予約の自動分割
```
2025年01月20日 一日 → 以下の3つに自動分割:
├─ 2025年01月20日 午前
├─ 2025年01月20日 午後
└─ 2025年01月20日 夜間
```

### アップロード時の注意点

#### ファイルサイズ制限
- **最大サイズ**: 16MB
- **推奨サイズ**: 5MB以下（処理速度向上）

#### ファイル形式と文字エンコード
- **対応形式**: CSVファイル（.csv）のみ
- **対応エンコード**: UTF-8、UTF-8-SIG、Shift_JIS、CP932、ISO-2022-JP
- **推奨**: UTF-8-SIG（Excel の「UTF-8 CSV」）

#### ファイル名の競合回避
- 同名ファイルがある場合、自動的に `ファイル名_1.csv` のように番号付き

## 📅 予約情報の確認

### カレンダー表示

#### 日付の選択
1. **サイドバーの日付選択**で表示したい日を選択
2. カレンダーが選択した日の予約状況を表示
3. **本日の予約はピンク色でハイライト**

#### 会議室フィルター
1. **サイドバーの会議室一覧**で表示したい会議室をチェック
2. チェックした会議室のみがカレンダーに表示
3. **全選択/全解除**ボタンで一括操作


### 予約詳細の確認

#### 予約ブロックのクリック
1. カレンダー上の**予約ブロックをクリック**
2. **詳細モーダル**が開き、以下の情報が表示されます：
   - 利用日時
   - 会議室名
   - 案内表示名
   - 事業所名
   - 担当者名
   - 延長・備品情報
   - その他の詳細情報

#### 特別な表示機能

**分割表示会議室**
- 「ホール全」の予約は自動的に関連会議室に分割表示
- config.json の分割設定に基づく

**料金による色分け**
- 合計金額0円 → 黄色（特別料金）
- 有料予約 → 青色（一般料金）

## ⚙️ 設定の変更

### 設定エディターの起動

**システムトレイから（推奨）:**
1. **システムトレイアイコンを右クリック**
2. **「設定エディタ」を選択**

**直接起動:**
1. **`python config_editor.pyw`** を実行

**Webから起動:**
1. **サイドバーの「カシカイ設定エディター」**をクリック

### 会議室設定の変更

#### 会議室の追加
1. **「会議室表示設定」**タブを選択
2. **「＋追加」**ボタンをクリック
3. 必要な情報を入力：
   - **CSV名**: CSVファイル内の会議室名
   - **表示名**: 画面に表示される名前
   - **ID**: システム内部で使用する識別子
   - **カラー**: 会議室固有の色設定

#### 会議室の編集・削除
1. 該当の会議室を選択
2. **「編集」**または**「削除」**ボタンをクリック

### CSVヘッダー設定

#### ヘッダーマッピングの変更
1. **「CSVヘッダー設定」**タブを選択
2. システム項目名に対応する**CSVヘッダー名**を入力
4. **「保存」**ボタンをクリック

#### 新しいヘッダーの追加
1. **「＋追加」**ボタンをクリック
2. **システム項目名**と**CSVヘッダー名**を入力

### 分割表示設定

#### 分割ルールの設定
1. **「会議室分割表示設定」**タブを選択
2. **分割元会議室**と**分割先会議室**を設定
3. **「有効」**チェックボックスで分割機能の ON/OFF を切り替え

## ❓ よくある質問

### 操作に関する質問

**Q: アップロードしたCSVがカレンダーに反映されない**
```
A: 以下を確認してください：
1. アップロード後2秒程度待つ
2. ブラウザを自動更新（10秒間隔）するか手動リフレッシュ（F5キー）
3. CSVヘッダーが設定と一致しているか確認
4. 日付形式が正しいか確認（2025年01月20日 形式）
5. システムトレイの「システム情報」でログ確認
```

**Q: システムトレイアイコンが表示されない**
```
A: 以下をお試しください：
1. 管理者権限でプログラム実行
2. Windowsの通知設定確認
3. システムトレイの「隠れているインジケーター」を確認
4. 直接 python server_fixed.py で起動
```

**Q: 会議室が表示されない**
```
A: 以下を確認してください：
1. サイドバーの会議室フィルターがチェックされているか
2. config.json の会議室設定が正しいか
3. CSVファイル内の会議室名が設定と一致しているか
4. 設定エディタで会議室設定を再確認
```

**Q: 文字化けが発生する**
```
A: CSVファイルの文字エンコードを確認してください：
1. Excel の場合: 「UTF-8 CSV」で保存
2. テキストエディターの場合: UTF-8で保存
3. システムは複数エンコードに対応済み（UTF-8、Shift_JIS、CP932等）
```

### データに関する質問


**Q: 過去のデータを確認したい**
```
A: 以下の方法があります：
1. 「processed」フォルダ内のタイムスタンプ付きCSVファイルを確認
2. data/processed_bookings.csv で統合データを確認
3. 必要に応じて過去のCSVファイルを uploads フォルダに再配置
```

**Q: 重複した予約データがある**
```
A: システムは自動的に重複を排除します：
1. 同一日・同一会議室・同一時間帯の予約は1つにまとめられます
2. 最新のアップロードデータが優先されます
3. source_file 列で元ファイルを追跡可能
```

**Q: 一日予約が複数に分かれて表示される**
```
A: これは正常な動作です：
1. 「一日」予約は自動的に午前・午後・夜間に分割表示
2. 実際の利用者には全時間帯が利用可能
3. 分割ロジックは server_fixed.py で実装済み
```

### 技術的な質問

**Q: 他のPCからアクセスしたい**
```
A: ネットワーク設定の確認：
1. システムトレイの「システム情報」でネットワークURLを確認
2. ファイアウォールでポート5000を開放
3. 同一ネットワーク内のPCから http://[IPアドレス]:5000 でアクセス
```

**Q: システムが重い・遅い**
```
A: 以下をお試しください：
1. 大量のCSVデータを小分けにしてアップロード
2. ブラウザのキャッシュをクリア
3. PCの再起動
4. processed フォルダの古いファイルを整理
5. システムトレイから他のアプリケーションを終了
```

**Q: バックアップを取りたい**
```
A: 以下のファイルをバックアップしてください：
1. config.json（設定ファイル）
2. data/processed_bookings.csv（統合データ）
3. processed フォルダ内のタイムスタンプ付きCSVファイル
4. uploads フォルダ（未処理ファイルがある場合）
```

**Q: ポートが使用できない**
```
A: システムが自動的に対応します：
1. ポート5000が使用中の場合、自動的に次のポート(5001〜5009)を試行
2. 起動時のコンソール出力で使用されたポート番号を確認
3. トラブルが続く場合は、他のアプリケーションを終了してから再起動
```

## 🚨 緊急時の対応

### システムが起動しない場合

1. **VBSセットアップで再起動**:
   ```
   easy_setup_silent.vbs をダブルクリック
   ```

2. **コマンドプロンプトで手動起動**:
   ```cmd
   cd C:\Users\[ユーザー名]\Documents\Gemini\kasikai2
   python server_fixed.py
   ```

3. **エラーメッセージの確認**:
   - コンソール出力でエラー内容を確認
   - エラー内容をメモして管理者に連絡

4. **設定ファイルの復旧**:
   - config.json のバックアップから復旧
   - 設定エディターで初期設定を再実行

### データが消えた場合

1. **「processed」フォルダの確認**:
   - 過去に処理されたタイムスタンプ付きCSVファイルを確認
   - 必要に応じて uploads フォルダに再配置

2. **バックアップからの復旧**:
   - processed_bookings.csv のバックアップを確認
   - data フォルダにコピーして復旧

3. **自動クリーンアップの確認**:
   - システムは前日以前のprocessedファイルを自動削除
   - 必要なファイルは事前にバックアップを推奨

---

## 📞 サポート

操作で不明な点や問題が発生した場合：

1. **FAQ確認**: よくある質問で同様の問題がないか確認
2. **システム情報確認**: システムトレイの「システム情報」でシステム状態確認
3. **ログ確認**: コンソール出力やシステムログでエラー詳細を確認
4. **管理者連絡**: 問題が解決しない場合は管理者に連絡

### サポート情報
- **システムURL**: http://localhost:5000（デフォルト、競合時は自動で次のポート使用）
- **ポート**: 5000（デフォルト）
- **対応ファイル形式**: CSV（複数エンコード対応）
- **対応OS**: Windows 10/11
- **必要環境**: Python 3.7以上

---

**📝 このマニュアルは継続的に更新されます。最新版をご確認ください。**