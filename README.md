# 会議室予約システム (ローカル版)

## 概要

このシステムは、会議室の予約状況をWebブラウザで確認するためのアプリケーションです。

`uploads` フォルダに置かれた予約CSVファイルを自動処理し、Webページでカレンダー形式の予約状況を表示します。
システムトレイに常駐し、データの更新処理は完全自動化されています。

**このバージョンはGoogleスプレッドシートを使用せず、すべてのデータはPCのローカル環境で完結します。**

## システム構成

1. **`easy_setup_gui.vbs`**: 初回セットアップ用GUIツール。ダブルクリックするだけで環境構築が完了します。
2. **`server_fixed.py`**: メインアプリケーション。システムトレイ常駐型のWebサーバーです。
3. **`config_editor.pyw`**: GUIベースの設定エディター。会議室名や表示項目を直感的に設定できます。

## 主な機能

### 🎯 **ワンクリックセットアップ**
- `easy_setup_gui.vbs` でPython環境チェック、ライブラリインストール、設定まで全自動
- GUIダイアログでユーザーフレンドリーなセットアップ体験

### 🖥️ **システムトレイ統合**
- Windows システムトレイに常駐
- 右クリックメニューで簡単操作（ブラウザで開く、設定変更、システム情報、終了）
- バックグラウンド動作でリソース効率化

### ⚙️ **高度な設定機能**
- **設定エディタ**: GUIで会議室名、表示項目、CSV列マッピングを簡単設定
- **柔軟なCSV対応**: 様々なCSVフォーマットに対応（エンコーディング自動判定）
- **カスタムカラー**: 会議室ごとの色分け表示

### 📊 **スマートなデータ処理**
- **自動ファイル監視**: `uploads` フォルダを常時監視、CSVファイル追加で即座に処理
- **データクレンジング**: 重複排除、無効データ除外
- **「一日」予約分割**: 一日予約を午前・午後・夜間に自動分割
- **複数エンコーディング対応**: UTF-8、Shift_JIS、CP932など自動判定

### 🌐 **モダンなWebインターフェース**
- **レスポンシブデザイン**: モバイル・タブレット・PC対応
- **手動データ更新**: 「🔄 ステータス更新」ボタンまたはブラウザリロードで更新
- **カレンダー表示**: 月・週・日単位の切り替え表示（月曜日を週の始まりで表示）
- **詳細ポップアップ**: 予約情報の詳細表示
- **検索・フィルター機能**: 会議室、日付、予約者での絞り込み

### 🔒 **安全性とメンテナンス**
- **自動ファイル管理**: 処理済みファイルの自動移動・古いファイルクリーンアップ
- **エラーハンドリング**: 堅牢なエラー処理とログ記録
- **リカバリー機能**: システム異常時の自動復旧

## 必要なもの

- Windows PC
- Python 3.7以上（自動インストール対応）

## セットアップ手順

### 🚀 **新導入フロー（4ステップ）**

#### ステップ1: 📁 基本インストール
1. **`easy_setup_gui.vbs` をダブルクリック**
   - Python環境チェック（未インストールの場合は自動案内）
   - 必要ライブラリの自動インストール
   - **サンプルデータでシステム自動起動**
   - **ブラウザ自動オープン**: http://localhost:5000

#### ステップ2: 🔍 動作確認
   - **ローカルカレンダー表示**をサンプルデータで確認
   - **システムトレイに青いアイコン**が表示されることを確認

#### ステップ3: 📥 実データダウンロード
   - **KasikaiCSVdl2** で実際のCSVデータをダウンロード
     - 別途提供される予約データダウンロードツール
     - 会議室予約管理システムから最新データを取得
   - **uploadsフォルダ**に自動配置
   - **processed_bookings.csv** が作成される

#### ステップ4: ⚙️ 実組織設定
   - **システムトレイアイコン** → 「設定エディタ」
   - 実際のCSVデータから**会議室設定を読み込み**
   - **カレンダー表示設定完了**

**🎉 本格運用開始！**

### 🛠️ **手動セットアップ**

```bash
# 必要ライブラリのインストール
pip install -r requirements.txt

# 直接起動
python server_fixed.py
```

## 使い方

### 1. **アプリケーションの起動**

**方法1: VBSセットアップから**
- `easy_setup_gui.vbs` をダブルクリック → セットアップ完了後に自動起動

**方法2: 直接起動**
- `python server_fixed.py` を実行

**方法3: バッチファイル**
- `easy_setup.bat` をダブルクリック

### 2. **システムトレイ操作**

PCの右下にある会議室アイコンを右クリック：
- **ブラウザで開く**: http://localhost:5000 を自動で開く
- **設定エディタ**: 会議室設定画面を起動
- **システム情報**: アクセスURL、フォルダ情報を表示
- **終了**: システム終了

### 3. **設定の変更**

**GUI設定エディタ（推奨）**
- システムトレイ → 「設定エディタ」
- または `python config_editor.pyw` を直接実行

**手動設定**
- `config.json` を直接編集

### 4. **予約データの更新**

1. 予約CSVファイルを **`uploads`** フォルダに保存
2. 自動的に処理開始（約2秒後）
3. 処理完了後、ファイルは `processed` フォルダに移動
4. Webページに即座に反映

### 5. **予約状況の確認**

**ローカルアクセス**: http://localhost:5000
**ネットワークアクセス**: http://[PCのIPアドレス]:5000

## 主要な機能とAPI

### Webインターフェース
- `/` - メイン画面（カレンダー表示）
- `/api/config` - 設定情報取得
- `/api/bookings` - 予約データ取得
- `/api/status` - システム状態確認

### システム機能
- **自動ファイル監視**: uploadsフォルダの変更検知
- **データ処理**: CSV読み込み、クレンジング、統合
- **ファイル管理**: 処理済みファイル移動、古いファイル削除
- **手動データ更新**: 「🔄 ステータス更新」ボタンまたはブラウザリロードで表示更新

## KasikaiCSVdl2連携

### 連携システム概要
**KasikaiCSVdl2** は、この会議室予約表示システムと連携する専用のCSVダウンロードツールです。

### 主要機能
- **自動データ取得**: 会議室予約管理システムから最新の予約データを取得
- **自動ファイル配置**: ダウンロードしたCSVファイルをuploadsフォルダに自動配置
- **シームレス連携**: この予約表示システムが自動的にデータを処理
- **統合データ作成**: processed_bookings.csvとして統合されたデータを生成

### 連携フロー
1. **KasikaiCSVdl2** → 予約管理システムからCSVデータダウンロード
2. **uploadsフォルダ** → 自動ファイル配置
3. **予約表示システム** → ファイル監視・自動データ処理
4. **データ統合** → processed_bookings.csv作成
5. **Webカレンダー** → 最新データ表示（手動更新で反映）

### 自動化オプション
- KasikaiCSVdl2の自動アップロード機能を使用可能
- 定期的なデータ更新で常に最新の予約情報を維持
- 手動でもuploadsフォルダにファイル配置するだけで処理

## ネットワーク共有

### 1. **IPアドレス確認**
システム起動時に表示される情報、またはシステムトレイ → 「システム情報」で確認

### 2. **ファイアウォール設定**
Windows Defender ファイアウォール:
- ポート: 5000
- プロトコル: TCP
- 受信規則を追加

### 3. **他のPCからアクセス**
ブラウザで `http://[サーバーPCのIP]:5000` にアクセス

## トラブルシューティング

- **Python未インストール**: `easy_setup_gui.vbs` が自動で案内
- **ライブラリエラー**: `pip install -r requirements.txt` を実行
- **ポート競合**: システムが自動的に次のポート(5001〜5009)を試行します
- **CSV読み込みエラー**: エンコーディングの問題。ファイルをUTF-8で保存
- **システムトレイ未表示**: 管理者権限で実行

## フォルダ構成

```
kasikai2/
├── easy_setup_gui.vbs      # GUIセットアップ
├── server_fixed.py         # メインアプリケーション
├── config_editor.pyw       # 設定エディター
├── index.html             # Webインターフェース
├── config.json            # 設定ファイル
├── requirements.txt       # 依存ライブラリ
├── data/                  # 処理済みデータ
├── uploads/               # CSVアップロードフォルダ
├── processed/            # 処理済みファイル保存
└── docs/                 # ドキュメント
```

## サポート情報

- **ポート**: 5000（デフォルト）、競合時は自動で次のポート(5001〜5009)を使用
- **対応CSV**: UTF-8, Shift_JIS, CP932, ISO-2022-JP
- **対応ブラウザ**: Chrome, Firefox, Edge, Safari
- **OS**: Windows 10/11
- **Python**: 3.7以上

---

**📞 サポート**: 設定や使用方法でご不明な点がございましたら、システム管理者にお問い合わせください。