# 会議室予約システム (v3)

## 概要

このシステムは、会議室の予約状況をWebブラウザで確認するためのアプリケーションです。

`申し込みデータ` フォルダに置かれた予約CSVファイルをGoogleスプレッドシートに集約し、Webページでカレンダー形式の予約状況を表示します。
バックグラウンドで常時稼働し、データの更新処理は完全自動化されています。

## システム構成

1.  **`run_host_services.bat`**: このバッチファイルでアプリケーション全体を起動します。システムトレイにアイコンが常駐します。
2.  **`host_app.py`**: システムトレイ常駐のメインプログラム。以下の２つのプロセスをバックグラウンドで起動・管理します。
    *   **`upload_script.py`**: `申し込みデータ` フォルダを常に監視し、ファイルが追加・変更されると約1分後に、内容を検証・重複排除してGoogleスプレッドシートを更新します。
    *   **`app.py`**: FlaskのWebサーバー。ブラウザからのリクエストに応じてGoogleスプレッドシートから最新の予約データを取得し、Webページを生成します。

## 主な機能

*   **カレンダー表示**: 予約状況を月・週・日単位で表示します。
*   **詳細情報表示**: 予約セルクリックで詳細情報をポップアップ表示します。
*   **全自動データ更新**: `申し込みデータ` フォルダにCSVファイルを置くだけで、約1分後に自動的にスプレッドシートに反映されます。
*   **データクレンジング機能**: 更新時にキャンセル済みの予約は自動で除外され、有効な予約の重複は自動的に1件に統合されます。
*   **バックグラウンド実行**: システムトレイに常駐し、コマンドプロンプトを閉じた状態でも動作します。

## 必要なもの

*   Python 3
*   Google Cloud プロジェクト
*   Google スプレッドシート

## セットアップ手順

### 1. Google Cloudとスプレッドシートの準備

1.  **Google Cloudでプロジェクトを作成**し、`Google Drive API` と `Google Sheets API` を有効化します。
2.  **サービスアカウントを作成**し、キー（JSON形式）をダウンロードします。
3.  キーファイルの名前を `credentials.json` に変更し、このアプリケーションのフォルダ（`kasikai`フォルダ）直下に配置します。
4.  **Googleスプレッドシートを新規作成**し、シート名を `kasikai予約台帳` にします。
5.  スプレッドシートの「共有」設定で、`credentials.json`内の`client_email`（例: `xxxx@xxxx.iam.gserviceaccount.com`）を「編集者」として追加します。

### 2. Python環境のセットアップ

1.  このフォルダ（`kasikai`）でコマンドプロンプトを開きます。
2.  以下のコマンドを実行し、必要なライブラリをインストールします。
    ```
    pip install -r requirements.txt
    ```

## 使い方

### 1. アプリケーションの起動

`run_host_services.bat` をダブルクリックします。
PCの右下、システムトレイに青い四角のアイコンが表示されれば起動成功です。

### 2. 毎日の作業（予約データの更新）

1.  毎日ダウンロードする予約情報のCSVファイルを、**`申し込みデータ`** フォルダの中にすべて保存します。
2.  約1分待つと、データが自動でスプレッドシートに反映されます。（手動の操作は不要です）

### 3. 予約状況の確認

Webブラウザで以下のアドレスにアクセスします。
[http://127.0.0.1:5000/](http://127.0.0.1:5000/)

### 4. アプリケーションの終了

システムトレイにある青いアイコンを**右クリック**し、表示されたメニューから「終了」を選択します。

## 他のPCからのアクセス方法

このアプリケーションは、起動したPCだけでなく、同じネットワークに接続された他のPCからも閲覧できます。

### 1. サーバーPCのIPアドレスを確認する

アプリケーションを起動（`run_host_services.bat` を実行）すると、黒い画面（コマンドプロンプト）に以下のようなメッセージが表示されます。この`http://...`で示されるURLが、他のPCからアクセスするためのアドレスです。

```
--- Starting Web Server ---
Access the application from other devices on the same network using the following URL:
http://192.168.1.10:5000
-------------------------------------------------
```

もしこの画面を閉じてしまった場合は、コマンドプロンプトで `ipconfig` と入力して実行し、「IPv4 アドレス」の項目を確認してください。

### 2. ファイアウォールの設定

他のPCからのアクセスを許可するため、サーバーPCでファイアウォールの設定が必要な場合があります。

1.  Windows セキュリティ > 「ファイアウォールとネットワーク保護」 > 「詳細設定」を開きます。
2.  「受信の規則」を選択し、「新しい規則」を作成します。
3.  以下の設定で規則を作成します。
    *   **規則の種類**: `ポート`
    *   **プロトコルおよびポート**: `TCP`、特定のローカルポート `5000`
    *   **操作**: `接続を許可する`
    *   **プロファイル**: `ドメイン` と `プライベート` にチェック（職場のネットワーク環境に合わせてください）
    *   **名前**: `会議室予約システム` など分かりやすい名前を付ける

### 3. 他のPCからアクセスする

閲覧したいPCのWebブラウザで、ステップ1で確認したURLアドレスを入力します。

例: `http://127.0.0.1:5000`
